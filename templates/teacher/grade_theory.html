{% extends 'base.html' %}
{% block title %}Grade Theory Questions{% endblock %}
{% block extra_head %}
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['\\(','\\)'], ['$','$']]}
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_HTML"></script>
{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-2xl font-bold mb-2">{{ quiz.title }} - Grade Theory Questions</h2>
        <a href="{% url 'quiz_management' %}" class="text-blue-600 hover:underline">‚Üê Back to Quizzes</a>
    </div>
    {% for data in attempts_data %}
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">{{ data.attempt.student.user.get_full_name }} ({{ data.attempt.student.student_id }})</h3>
            <span class="{% if data.attempt.is_graded %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %} px-3 py-1 rounded text-sm">
                {% if data.attempt.is_graded %}Graded{% else %}Pending{% endif %}
            </span>
        </div>
        {% for item in data.theory_answers %}
        <div class="border-t pt-4 mt-4">
            <h4 class="font-medium mb-2">{{ item.question.question_text|safe }}</h4>
            <div class="bg-gray-50 p-4 rounded mb-4">
                <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ item.answer.theory_answer|default:"No answer provided" }}</p>
            </div>
            <form method="post" class="flex items-end space-x-4">
                {% csrf_token %}
                <input type="hidden" name="answer_id" value="{{ item.answer.id }}">
                <div>
                    <label class="block text-sm font-medium mb-1">Score (Max: {{ item.question.max_marks }})</label>
                    <input type="number" name="score" min="0" max="{{ item.question.max_marks }}" step="0.5" value="{{ item.answer.manual_score }}" required class="w-24 px-3 py-2 border rounded">
                </div>
                <div class="flex-1">
                    <label class="block text-sm font-medium mb-1">Feedback</label>
                    <input type="text" name="feedback" value="{{ item.answer.teacher_feedback }}" class="w-full px-3 py-2 border rounded">
                </div>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Save</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% empty %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500">No submissions found</p>
        <a href="{% url 'quiz_management' %}" class="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded">Back to Quizzes</a>
    </div>
    {% endfor %}
</div>
<script>
if (typeof MathJax !== 'undefined') {
    MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
}
</script>
{% endblock %}